# Manee
This little Go program helps generating CRUD operations from your Go's struct.  
Manee uses Go standard package: AST to read your struct code and struct field tags.  
**I use PostgreSQL so this was tested only with PostgreSQL.**  
**Go struct file must be valid and compilable**  


## Usage
Use **// table:"table_name"** to define your table name.  
    If not specifiy, Manee assumes that your table has the same name as your struct name.  
Use **db:"field_name"** to define your field name.  
    Manee will skip struct property which doesn't have **db** tag in it.  
Use **primary** tag in struct tag to specify primary key.  

## Sample struct
```go
package models

import "time"

//  table:"table_person"
//  another line of comment passing by.
type Person struct {
    ID        string    `json:"id,omitempty" db:"id,primary"`
    Name      *string   `json:"name,omitempty" db:"name"`
    Address   string    `json:"address,omitempty" db:"address"`
    Published *bool     `json:"published,omitempty" db:"published"`
    Created   time.Time `json:"created,omitempty" db:"created"`
}
```


## Run
> go build  
> ./manee -f=yourStructFile.go

## Result
Manee will create a new directory where your struct file is located.  
Directory contains 3 files.  
*struct_name*_mock_manee.go  
*struct_name*_repository_manee.go  
*struct_name*_service_manee.go  

Manee uses repository and dependency injection pattern.  

Open *struct_name*_service_manee.go and you will see  

```go
    //m := &PersonRepository{DB: nil}
    m := &MockPersonRepository{}
```  
When you want to test with your database, simply uncomment and inject your *sql.DB connection into it.

## Sample code generated from Manee

**person_service_manee.go**  
```go
// This file is generated by Manee.
// 2015-11-24 13:28:35.872030532 +0000 GMT
package person

import "awesome_api/models"

type PersonService struct {
    PersonServiceManager
}

type PersonServiceManager interface {
    GetAllPerson() (*[]models.Person, error)
    GetPerson(ID string) (*models.Person, error)
    InsertPerson(p *models.Person) (*models.Person, error)
    UpdatePerson(p *models.Person) (*models.Person, error)
    DeletePerson(p *models.Person) (*models.Person, error)
}

func NewPersonService() *PersonService {
    //m := &PersonRepository{DB: nil}
    m := &MockPersonRepository{}
    return &PersonService{ PersonServiceManager: m }
}
```

**person_repository_manee.go**  
```go
// This file is generated by Manee.
// 2015-11-24 13:28:35.870952504 +0000 GMT
package person

import (
    "awesome_api/models"
    "database/sql"
)

type PersonRepository struct {
    DB *sql.DB
}

func (d *PersonRepository) GetAllPerson() (*[]models.Person, error) {
    stmt, err := d.DB.Prepare(`SELECT id, name, address, published, created FROM table_person;`)
    if err != nil {
        return nil, err
    }
    defer stmt.Close()
    rows, err := stmt.Query()
    if err != nil {
        return nil, err
    }
    defer rows.Close()
    list := []models.Person{}
    for rows.Next() {
        p := models.Person{}
        errScan := rows.Scan(&p.ID, &p.Name, &p.Address, &p.Published, &p.Created)
        if errScan != nil {
            return nil, err
        }
        list = append(list, p)
    }
    return &list, nil
}

func (d *PersonRepository) GetPerson(ID string) (*models.Person, error) {
    stmt, err := d.DB.Prepare(`SELECT id, name, address, published, created FROM table_person where id=$1;`)
    if err != nil {
        return nil, err
    }
    p := models.Person{}
    err = stmt.QueryRow(ID).Scan(&p.ID, &p.Name, &p.Address, &p.Published, &p.Created)
    if err != nil {
        return nil, err
    }
    return &p, nil
}

func (d *PersonRepository) InsertPerson(p *models.Person) (*models.Person, error) {
    stmt, err := d.DB.Prepare(`INSERT INTO table_person(id, name, address, published, created) VALUES($1, $2, $3, $4, $5) returning id, name, address, published, created;`)
    if err != nil {
        return nil, err
    }
    err = stmt.QueryRow(p.ID, p.Name, p.Address, p.Published, p.Created).Scan(&p.ID, &p.Name, &p.Address, &p.Published, &p.Created)
    if err != nil {
        return nil, err
    }
    return p, nil
}

func (d *PersonRepository) UpdatePerson(p *models.Person) (*models.Person, error) {
    stmt, err := d.DB.Prepare(`UPDATE table_person SET name=$2, address=$3, published=$4, created=$5 where id=$1 returning id, name, address, published, created;`)
    if err != nil {
        return nil, err
    }
    err = stmt.QueryRow(p.ID, p.Name, p.Address, p.Published, p.Created).Scan(&p.ID, &p.Name, &p.Address, &p.Published, &p.Created)
    if err != nil {
        return nil, err
    }
    return p, nil
}

func (d *PersonRepository) DeletePerson(p *models.Person) (*models.Person, error) {
    stmt, err := d.DB.Prepare(`DELETE from table_person where id=$1 returning id, name, address, published, created;`)
    if err != nil {
        return nil, err
    }
    err = stmt.QueryRow(p.ID).Scan(&p.ID, &p.Name, &p.Address, &p.Published, &p.Created)
    if err != nil {
        return nil, err
    }
    return p, nil
}

```

**person_mock_manee.go**  
```go
// This file is generated by Manee.
// 2015-11-24 13:28:35.872030532 +0000 GMT
package person

import "awesome_api/models"

type MockPersonRepository struct {
}

func (d *MockPersonRepository) GetAllPerson() (*[]models.Person, error) {
    return nil, nil
}

func (d *MockPersonRepository) GetPerson(ID string) (*models.Person, error) {
    return nil, nil
}

func (d *MockPersonRepository) InsertPerson(p *models.Person) (*models.Person, error) {
    return nil, nil
}

func (d *MockPersonRepository) UpdatePerson(p *models.Person) (*models.Person, error) {
    return nil, nil
}

func (d *MockPersonRepository) DeletePerson(p *models.Person) (*models.Person, error) {
    return nil, nil
}

```

## TODO
* Finished mock repository. Going to generate sample data.
* Generate controller and front end perhaps.

